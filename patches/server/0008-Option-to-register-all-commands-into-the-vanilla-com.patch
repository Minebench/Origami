From e8fe1857c3a5ab22033def912a1b1d51030b33dd Mon Sep 17 00:00:00 2001
From: Phoenix616 <mail@moep.tv>
Date: Mon, 15 Jul 2019 03:10:03 +0100
Subject: [PATCH] Option to register all commands into the vanilla command map

---
 .../java/de/minebench/origami/config/OrigamiConfig.java    | 5 +++++
 src/main/java/org/bukkit/craftbukkit/CraftServer.java      | 7 ++++++-
 2 files changed, 11 insertions(+), 1 deletion(-)

diff --git a/src/main/java/de/minebench/origami/config/OrigamiConfig.java b/src/main/java/de/minebench/origami/config/OrigamiConfig.java
index 15b974331..9c4ce6a34 100644
--- a/src/main/java/de/minebench/origami/config/OrigamiConfig.java
+++ b/src/main/java/de/minebench/origami/config/OrigamiConfig.java
@@ -146,4 +146,9 @@ public final class OrigamiConfig {
         }
     }
 
+    public static boolean registerCommandsIntoVanillaDispatcher = false;
+    private static void registerCommandsIntoVanillaDispatcher() {
+        registerCommandsIntoVanillaDispatcher = getBoolean("commands.register-into-vanilla-dispatcher", registerCommandsIntoVanillaDispatcher);
+    }
+
 }
\ No newline at end of file
diff --git a/src/main/java/org/bukkit/craftbukkit/CraftServer.java b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
index a8ac59d54..b31fdf7fe 100644
--- a/src/main/java/org/bukkit/craftbukkit/CraftServer.java
+++ b/src/main/java/org/bukkit/craftbukkit/CraftServer.java
@@ -394,7 +394,12 @@ public final class CraftServer implements Server {
 
     private void syncCommands() {
         // Clear existing commands
-        CommandDispatcher dispatcher = console.commandDispatcher = new CommandDispatcher();
+        // Origami start - Register commands directly in Vanilla dispatcher
+        if (!OrigamiConfig.registerCommandsIntoVanillaDispatcher) {
+            console.commandDispatcher= new CommandDispatcher();
+        }
+        CommandDispatcher dispatcher = console.commandDispatcher;
+        // Origami end
 
         // Register all commands, vanilla ones will be using the old dispatcher references
         for (Map.Entry<String, Command> entry : commandMap.getKnownCommands().entrySet()) {
-- 
2.18.0.windows.1

